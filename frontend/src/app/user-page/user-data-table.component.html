<div class="user-data-table-bg">
  <div class="user-data-table-container">
    <!-- Header -->
    <div class="table-header">
      <h2><mat-icon class="header-icon">analytics</mat-icon> Datos de Sensores</h2>
      <div class="header-actions">
        <mat-form-field appearance="outline" class="search-field" [class.search-active]="isSearchActive">
          <input matInput 
                 [(ngModel)]="searchTerm" 
                 (ngModelChange)="applyFilter($event)" 
                 (focus)="activateSearch()"
                 (blur)="deactivateSearch()"
                 placeholder="Busca por id, sensor, valor y estado" />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
    </div>

    <!-- Filtros avanzados -->
    <div class="filters-container">
      <div class="filters-row">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Tipo de Sensor</mat-label>
          <mat-select [(ngModel)]="filtroSensor" (selectionChange)="aplicarFiltroSensor()">
            <mat-option *ngFor="let sensor of sensoresDisponibles" [value]="sensor.value">
              {{ sensor.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Estado</mat-label>
          <mat-select [(ngModel)]="filtroEstado" (selectionChange)="aplicarFiltroEstado()">
            <mat-option *ngFor="let estado of estadosDisponibles" [value]="estado.value">
              {{ estado.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-stroked-button (click)="limpiarFiltros()" class="clear-filters-btn">
          <mat-icon>clear</mat-icon>
          Limpiar Filtros
        </button>
      </div>
    </div>

    <!-- Indicador de carga -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando datos de sensores...</p>
    </div>

    <!-- Tabla -->
    <div class="table-wrapper" *ngIf="!isLoading">
      <table mat-table [dataSource]="dataSource" matSort class="user-data-table mat-elevation-z0">
        <!-- Columnas -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let item">{{ item.id }}</td>
        </ng-container>

        <ng-container matColumnDef="sensor">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Sensor</th>
          <td mat-cell *matCellDef="let item">
            <div class="sensor-cell">
              <mat-icon class="sensor-icon">{{ item.icono }}</mat-icon>
              <span>{{ item.sensor }}</span>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="valor">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Valor</th>
          <td mat-cell *matCellDef="let item">
            <div class="value-cell">
              <span class="value-number">{{ item.valor }}</span>
              <span class="value-unit">{{ item.unidad }}</span>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
          <td mat-cell *matCellDef="let item">
            <span class="status-badge" [ngClass]="'status-' + item.estado.toLowerCase()">
              <mat-icon class="status-icon">{{ item.estadoIcono }}</mat-icon>
              {{ item.estado }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="fecha">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha y Hora</th>
          <td mat-cell *matCellDef="let item">
            <div class="datetime-cell">
              <div class="date">{{ item.fecha | date:'dd/MM/yyyy' }}</div>
              <div class="time">{{ item.fecha | date:'HH:mm:ss' }}</div>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
      </table>

      <!-- Mensaje cuando no hay datos -->
      <div *ngIf="dataSource && dataSource.filteredData.length === 0" class="no-data">
        <p>No se encontraron datos</p>
      </div>
    </div>

    <!-- Contador de registros -->
    <mat-paginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons *ngIf="!isLoading"></mat-paginator>
  </div>
</div>



